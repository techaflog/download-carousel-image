<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Download Carousel Images as ZIP</title>
    <!-- Include JSZip Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
</head>
<body>
    <h1>Download Carousel Images as ZIP</h1>
    <p id="status">Preparing to download...</p>

    <script>
        window.onload = function() {
            // Here, p1 will be the Glide template variable containing the URLs
            const imageLinks = p1;  // Assuming 'p1' is where the column data is passed

            if (imageLinks) {
                const zip = new JSZip();  // Create a new JSZip instance
                const urls = imageLinks.split(',');  // Split the URLs into an array
                let promises = [];

                // Iterate over each image URL and fetch it
                urls.forEach((url, index) => {
                    const fileName = url.trim().substring(url.lastIndexOf('/') + 1);  // Extract the filename
                    const promise = fetch(url.trim())  // Remove spaces around URLs
                        .then(response => response.blob())
                        .then(blob => {
                            zip.file(fileName, blob, { binary: true });  // Add each image to the zip
                        })
                        .catch(error => {
                            console.error(`Error fetching file: ${url}`, error);
                        });
                    promises.push(promise);  // Add the promise to the array
                });

                // Once all images have been fetched, generate the ZIP file
                Promise.all(promises).then(() => {
                    zip.generateAsync({ type: "blob" }).then(function(content) {
                        const zipLink = document.createElement('a');
                        zipLink.href = URL.createObjectURL(content);
                        zipLink.setAttribute('download', 'carousel_images.zip');  // Name the ZIP file
                        document.body.appendChild(zipLink);
                        zipLink.click();  // Trigger the download
                        zipLink.remove();
                    });
                });
            } else {
                document.getElementById('status').textContent = 'No image URLs provided.';
            }
        }
    </script>
</body>
</html>
